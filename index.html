<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Precviƒçovanie nemƒçiny</title>

  <!-- PWA META -->
  <meta name="theme-color" content="#4f46e5" />
  <link rel="manifest" href="/nemecky-jazyk/manifest.webmanifest" />
  <link rel="apple-touch-icon" href="/nemecky-jazyk/icon.png">

  <!-- Tailwind + fonty -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f1f5f9;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
      box-sizing: border-box;
      user-select: auto;
    }
    .container {
      background-color: #f87171;
      border-radius: 1.5rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      padding: 2rem;
      max-width: 600px;
      width: 100%;
      text-align: center;
      border: 4px solid #818cf8;
    }
    .button {
      padding: 0.75rem 2rem;
      font-weight: bold;
      border-radius: 9999px;
      color: white;
      transition: all 0.2s ease-in-out;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .button-indigo { background-color: #4f46e5; }
    .button-indigo:hover { background-color: #4338ca; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button-green { background-color: #22c55e; }
    .button-green:hover { background-color: #16a34a; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button-blue { background-color: #3b82f6; }
    .button-blue:hover { background-color: #2563eb; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button-red { background-color: #ef4444; }
    .button-red:hover { background-color: #dc2626; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button:disabled { background-color: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }
    .word-display { min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .slovak-display { min-height: 50px; margin-top: 1rem; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .speak-button {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 0.5rem 1rem; font-weight: bold; border-radius: 9999px;
      color: white; transition: all 0.2s ease-in-out; cursor: pointer; margin-top: 0.5rem;
    }
    .speak-button:disabled { background-color: #cbd5e1; cursor: not-allowed; color: #64748b; }
    .credits-box { background-color: #d1fae5; border: 2px solid #34d399; border-radius: 0.5rem; padding: 1rem; margin-top: 2rem; text-align: center; }
    .credits-text { color: #7c3aed; font-weight: bold; }
    .panel { background:#fff;border:2px solid #818cf8;border-radius:1rem;padding:1rem;margin-bottom:1rem }
    .row { display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;align-items:center }
    .muted { opacity:.85 }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-3xl font-bold text-slate-800 mb-6">Precviƒçovanie nemƒçiny</h1>

    <!-- Panel automatick√©ho prehr√°vania -->
    <div class="panel">
      <div class="row">
        <button id="auto-start"  class="button button-green">‚ñ∂Ô∏è Spusti≈• auto</button>
        <button id="auto-pause"  class="button button-indigo" disabled>‚è∏Ô∏è Pauza</button>
        <button id="auto-resume" class="button button-indigo" disabled>‚ñ∂Ô∏è Pokraƒçova≈•</button>
        <button id="auto-stop"   class="button button-red"    disabled>‚èπÔ∏è Stop</button>
        <button id="auto-prev"   class="button button-blue"   disabled>‚èÆÔ∏è Predo≈°l√©</button>
        <button id="auto-next"   class="button button-blue"   disabled>‚è≠Ô∏è ƒéal≈°ie</button>
      </div>
      <div id="auto-status" class="muted" style="margin-top:.5rem;text-align:left">Pripraven√©‚Ä¶</div>
    </div>

    <div id="app-content"></div>

    <div class="credits-box">
      <span class="credits-text">Vytvoril: Ivan Kebra Nagast</span>
    </div>
  </div>

  <script>
    // ===== Ukladanie do localStorage =====
    const LS_KEY = 'nemeckyVocabV1';          // u≈æ√≠vateƒæom pridan√© slov√°
    const PROG_KEY = 'nemeckyProgressV1';     // progres: kapitola + indexy

    function loadUserVocab() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr.filter(x => x && x.german && x.slovak) : [];
      } catch { return []; }
    }
    function saveUserVocab(list) {
      try { localStorage.setItem(LS_KEY, JSON.stringify(list)); } catch {}
    }

    function saveProgress() {
      try {
        const data = {
          chapter: currentChapter,          // 'main' | 'kpak'
          mainIndex: currentWordIndex|0,
          kpakIndex: kpakIndex|0,
          showSlovak: !!showSlovak
        };
        localStorage.setItem(PROG_KEY, JSON.stringify(data));
      } catch {}
    }
    function loadProgress() {
      try {
        const raw = localStorage.getItem(PROG_KEY);
        if (!raw) return;
        const d = JSON.parse(raw) || {};
        if (d.chapter === 'kpak' || d.chapter === 'main') currentChapter = d.chapter;
        if (Number.isInteger(d.mainIndex)) currentWordIndex = d.mainIndex;
        if (Number.isInteger(d.kpakIndex)) kpakIndex = d.kpakIndex;
        showSlovak = !!d.showSlovak;
      } catch {}
    }

    // ===== TTS engine =====
    const TTS = (() => {
      const synth = window.speechSynthesis;
      function pickVoiceByLang(lang, preferNames = []) {
        const list = (synth.getVoices() || []).filter(v => (v.lang || "").toLowerCase().startsWith(lang.toLowerCase()));
        if (!list.length) return null;
        for (const name of preferNames) {
          const hit = list.find(v => (v.name || "").toLowerCase().includes(name.toLowerCase()));
          if (hit) return hit;
        }
        return list[0] || null;
      }
      async function speak(text, langCode) {
        if (!('speechSynthesis' in window)) return;
        const u = new SpeechSynthesisUtterance(String(text));
        u.lang = langCode;
        const prefer = langCode === "de-DE" ? ["Anna","Markus","Katja","Yannick"] : ["Laura","Zuzana","Filip","J√°n"];
        const voice = pickVoiceByLang(langCode, prefer);
        if (voice) u.voice = voice;
        u.rate = 1.0; u.pitch = 1.0; u.volume = 1.0;
        return new Promise(res => {
          try {
            synth.cancel();
            u.onend = res; u.onerror = res;
            synth.speak(u);
          } catch { res(); }
        });
      }
      return { speak, cancel(){ try{ speechSynthesis.cancel(); }catch{} } };
    })();

    // ===== OPRAVEN√ù Z√ÅKLADN√ù ZOZNAM SLOV√çƒåOK =====
    const BASE_VOCAB = [
      { german:"Vermutung", slovak:"domnienka, tu≈°enie" },
      { german:"Verm√∂gen", slovak:"majetok, schopnos≈•" },
      { german:"das √Ñu√üerste", slovak:"najkrajnej≈°ie; krajnos≈•" },
      { german:"die Ank√ºndigung", slovak:"ozn√°menie, ohl√°senie" },
      { german:"Fahrgestell", slovak:"podvozok" },
      { german:"sch√§tzen", slovak:"oceni≈•" },
      { german:"loslassen", slovak:"necha≈• √≠s≈•, pusti≈•" },
      { german:"loszulassen", slovak:"nepusti≈•, nikdy nenecha≈• √≠s≈•" },
      { german:"zusammenkommen", slovak:"da≈• sa dokopy, stretn√∫≈• sa" },
      { german:"auseinander", slovak:"od seba" },
      { german:"ein bisschen auseinanderstehen", slovak:"st√°≈• trochu od seba" },
      { german:"sich auseinanderentwickeln", slovak:"odcudzi≈• sa; rozi≈°li sa ich cesty",priklad:"Die beiden Freunde haben sich auseinanderentwickelt. ‚Üí T√≠ dvaja priatelia sa odcudzili / ich cesty sa rozi≈°li."},
      { german:"begegnen", slovak:"stretn√∫≈• (sa s niek√Ωm)" },
      { german:"begegnet", slovak:"stretol (sa)" },
      { german:"der Zweifel", slovak:"pochybnos≈•" },
      { german:"der Leichnam", slovak:"m≈ïtvola" },
      { german:"mitmachen", slovak:"z√∫ƒçastni≈• sa, prida≈• sa" },
      { german:"Ja, ich mache mit", slovak:"√Åno, prid√°m sa; √Åno, z√∫ƒçastn√≠m sa" },
      { german:"Ja, ich werde mitmachen", slovak:"√Åno, z√∫ƒçastn√≠m sa (v bud√∫cnosti)" },
      { german:"Ja, ich schlie√üe mich an", slovak:"√Åno, prip√°jam sa" },
      { german:"Rinderfilet", slovak:"hov√§dzia svieƒçkovica" },
      { german:"Auftragsverfolgung", slovak:"sledovanie objedn√°vky" },
      { german:"der Scherz", slovak:"≈æart" },
      { german:"die Zuversicht", slovak:"n√°dej, d√¥vera, viera" },
      { german:"abschlie√üen", slovak:"zamkn√∫≈•; uzavrie≈•" },
      { german:"aufschlie√üen", slovak:"odomkn√∫≈•" },
      { german:"Ich m√∂chte mich gerne nach der Miete erkundigen", slovak:"Chcel by som sa op√Ωta≈• na n√°jomn√©" },
      { german:"der Bluterguss", slovak:"modrina" },
      { german:"die Narbe", slovak:"jazva" },
      { german:"der Ausschlag", slovak:"vyr√°≈æka" },
      { german:"die Schnittwunde", slovak:"porezanie" },
      { german:"der Splitter", slovak:"trieska" },
      { german:"Gl√ºhw√ºrmchen", slovak:"svetlu≈°ka" },
      { german:"Einrichtungshaus", slovak:"obchod s n√°bytkom" },
      { german:"bewirkt", slovak:"sp√¥sob√≠" },
      { german:"Erwachen", slovak:"prebudenie" },
      { german:"Arbeitsunf√§higkeitsbescheinigung", slovak:"potvrdenie o pr√°ceneschopnosti (PN)" },
      { german:"Schuhe anziehen", slovak:"obu≈• si top√°nky" },
      { german:"Schuhe ausziehen", slovak:"vyzu≈• si top√°nky" },
      { german:"sich anziehen", slovak:"obliec≈• sa" },
      { german:"sich ausziehen", slovak:"vyzliec≈• sa" },
      { german:"Zieh deine Schuhe aus!", slovak:"Vyzuj si top√°nky!" },
      { german:"Zieh deine Sachen aus!", slovak:"Vyzleƒç si veci!" },
      { german:"Zieh dich aus!", slovak:"Vyzleƒç sa!" },
      { german:"Zieh dich aus, Baby!", slovak:"Vyzleƒç sa, zlatko!" },
      { german:"√ºbergeben", slovak:"odovzda≈•" },
      { german:"Ich betrachte das als eine L√ºge", slovak:"Pova≈æujem to za lo≈æ" },
      { german:"Sch√§m dich, so zu l√ºgen!", slovak:"Hanbi sa, ≈æe takto klame≈°!" },
      { german:"Gott segne dich", slovak:"Boh ti ≈æehnaj" },
      { german:"Kartoffeln sch√§len und w√ºrfeln", slovak:"Zemiaky o≈°√∫peme a nakr√°jame na kocky" },
      { german:"Nebelhorn", slovak:"hmlovka" },
      { german:"Schweinshaxe", slovak:"bravƒçov√© koleno" },
      { german:"So habe ich das nie gesagt! Du drehst mir immer das Wort im Munde herum!", slovak:"Nikdy som to tak nepovedal, v≈ædy prekr√∫ca≈° moje slov√°!" },
      { german:"Luftabwehr", slovak:"protivzdu≈°n√° obrana" },
      { german:"Gehirnersch√ºtterung", slovak:"otras mozgu" },
      { german:"Beinbruch", slovak:"zlomen√° noha" },
      { german:"Krankenhausaufenthalt", slovak:"hospitaliz√°cia" },
      { german:"Ich bin im Reinen mit mir", slovak:"Som so sebou vyrovnan√Ω" },
      { german:"Notaufnahme", slovak:"pohotovostn√Ω pr√≠jem" },
      { german:"Zinssatz", slovak:"√∫rokov√° sadzba" },
      { german:"Jahrzehnte", slovak:"desa≈•roƒçia" },
      { german:"LG / Liebe Gr√º√üe", slovak:"S pozdravom, srdeƒçn√© pozdravy" },
      { german:"Wer bist du?", slovak:"Kto si ty?" },
      { german:"Ich w√ºnschte, zwischen uns w√§re etwas", slovak:"Prial by som si, aby medzi nami nieƒço bolo" },
      { german:"Vogelgezwitscher", slovak:"vt√°ƒç√≠ spev, ≈°tebotanie" },
      { german:"Verkehrssituation", slovak:"dopravn√° situ√°cia" },
      { german:"Tr√§nens√§cke", slovak:"vaky pod oƒçami" },
      { german:"Inwiefern stimmen Sie den folgenden Aussagen zu?", slovak:"Do akej miery s√∫hlas√≠te s nasleduj√∫cimi tvrdeniami?" },
      { german:"Bin unentschieden", slovak:"Nie som rozhodnut√Ω" },
      { german:"Gelegentlich", slovak:"pr√≠le≈æitostne" },
      { german:"Lass dich nicht unterkriegen!", slovak:"Nenechaj sa zlomi≈•! Nepoddaj sa!" },
      { german:"das Magengeschw√ºr", slovak:"≈æal√∫doƒçn√Ω vred" },
      { german:"Befreiung von der Zuzahlung", slovak:"oslobodenie od poplatku za spolu√∫ƒças≈•" },
      { german:"Das Leben ist wirklich hart, wir m√ºssen st√§ndig k√§mpfen, und wir bekommen das Wichtigste nicht, n√§mlich die Liebe.", slovak:"≈Ωivot je ≈•a≈æk√Ω, mus√≠me st√°le bojova≈• a nedost√°va sa n√°m toho najd√¥le≈æitej≈°ieho ‚Äì l√°sky." },
      { german:"Fols√§ure", slovak:"kyselina listov√°" },
      { german:"abgehauen", slovak:"ujs≈•, zmizn√∫≈•" },
      { german:"Meine Gesundheit macht mir im Moment zu schaffen", slovak:"Moje zdravie mi teraz rob√≠ probl√©my" },
      { german:"Liegest√ºtze", slovak:"kliky" },
      { german:"Engagiert sich f√ºr die Einhaltung der Menschenrechte entlang seiner Lieferkette", slovak:"Zaviazali sa dodr≈æiava≈• ƒæudsk√© pr√°va v r√°mci dod√°vateƒæsk√©ho re≈•azca" },
      { german:"Im Folgenden geht es um das Thema Alltag", slovak:"Nasleduj√∫ci text sa t√Ωka ka≈ædodenn√©ho ≈æivota" },
      { german:"Vollzeit erwerbst√§tig", slovak:"zamestnan√Ω na pln√Ω √∫v√§zok" },
      { german:"beugen", slovak:"ohn√∫≈•" },
      { german:"strecken", slovak:"narovna≈•, natiahnu≈•" },
      { german:"Spreiz deine Beine!", slovak:"Roztiahni nohy!" },
      { german:"Gr√§tsche die Beine!", slovak:"Roztiahni nohy do≈°iroka!" },
      { german:"Verwechsle vier Dinge nicht: H√∂flichkeit ist kein Flirten, Aufmerksamkeit ist keine Liebe, Schweigen ist kein √Ñrger, und Tr√§nen sind keine Schw√§che.", slovak:"Nezamie≈àaj si ≈°tyri veci: zdvorilos≈• nie je flirtovanie, pozornos≈• nie je l√°ska, mlƒçanie nie je hnev a slzy nie s√∫ slabos≈•." },
      { german:"widerlich", slovak:"odporn√Ω, hnusn√Ω" },
      { german:"Abfindung", slovak:"odstupn√©" },
      { german:"Verkehrsunfall wegen eines Rasers", slovak:"dopravn√° nehoda kv√¥li r√Ωchlej jazde (vinn√≠kom je ‚Äûr√Ωchlik√°r‚Äú)" },
      { german:"Regierungschef", slovak:"ved√∫ci predstaviteƒæ vl√°dy" },
      { german:"Premierminister", slovak:"predseda vl√°dy" },
      { german:"Krampfadern (Varizen)", slovak:"k≈ïƒçov√© ≈æily" },
      { german:"Ich war gestern nicht gut drauf", slovak:"Vƒçera som nemal dobr√∫ n√°ladu" },
      { german:"√Ñrztliche Bereitschaftspraxis", slovak:"lek√°rska pohotovos≈•" },
      { german:"Wertstoffhof", slovak:"zbern√Ω dvor, recyklaƒçn√© centrum" },
      { german:"Kiefer brechen", slovak:"zlomi≈• ƒçeƒæus≈•" },
      { german:"Wiedereingliederung", slovak:"znovuzaradenie, reintegr√°cia" },
      { german:"Spine Massager", slovak:"mas√°≈æny pr√≠stroj na chrbticu" },
      { german:"Kommt mir bekannt vor", slovak:"zd√° sa mi to zn√°me" },
      { german:"Das Handgelenk lockert sich langsam", slovak:"Z√°p√§stie sa pomaly uvoƒæ≈àuje" },
      { german:"Gerichtsvollzieher", slovak:"s√∫dny exek√∫tor" },
      { german:"Ich gehe aus", slovak:"Idem von / Idem preƒç" },
      { german:"rund um die Uhr", slovak:"nonstop" },
      { german:"Voraussichtliche Zustellung", slovak:"odhadovan√© doruƒçenie" },
      { german:"krankheitsbedingt", slovak:"z d√¥vodu choroby" },
      { german:"Lob sei Gott", slovak:"Chv√°la Bohu" },
      { german:"Gott sei Dank", slovak:"Vƒèaka Bohu" },
      { german:"Erzieherin", slovak:"vychov√°vateƒæka" },
      { german:"je", slovak:"ƒç√≠m" },
      { german:"desto", slovak:"t√Ωm" },
      { german:"Wurst", slovak:"klob√°sa, √∫denina" },
      { german:"Blutwurst / Gr√ºtzwurst", slovak:"jaternica / krvavnica" },
      { german:"W√ºrstchen", slovak:"p√°rky" },
      { german:"Bratw√ºrstchen", slovak:"≈°pekaƒçky, mal√© klob√°sky" },
      { german:"Paketzusteller", slovak:"doruƒçovateƒæ bal√≠kov, kuri√©r" },

      { german:"Bei einer jungen Frau geht der Schwanz kaputt, aber bei einer alten Frau kann man gut √ºben.", slovak:"Na mladej ≈æene sa kokot niƒç√≠, na starej ≈æene sa dobre cviƒç√≠" },

      { german:"H√∂schen", slovak:"nohaviƒçky" },
      { german:"das Gleis", slovak:"koƒæaj, n√°stupi≈°te" },
      { german:"die Schiene", slovak:"dlaha, ort√©za; koƒæajnica" },
      { german:"die Strecke", slovak:"tra≈•, trasa, vzdialenos≈•" },
      { german:"Gesellschaft mit beschr√§nkter Haftung (GmbH)", slovak:"spoloƒçnos≈• s ruƒçen√≠m obmedzen√Ωm (s.r.o.)" },
      { german:"sich sch√§men", slovak:"hanbi≈• sa" },
      { german:"empfehlen", slovak:"odporuƒçi≈•" },
      { german:"Wunder", slovak:"z√°zrak" },
      { german:"teilnehmen", slovak:"z√∫ƒçastni≈• sa" },
      { german:"Er hat mir gesagt, dass meine Schulter anf√§ngt zu vernarben", slovak:"Povedal mi, ≈æe rameno sa zaƒç√≠na zjazvova≈•" },
      { german:"die Stirn", slovak:"ƒçelo" },
      { german:"die Ferse", slovak:"p√§ta" },
      { german:"die Handfl√§che", slovak:"dla≈à" },
      { german:"der Fu√ür√ºcken", slovak:"priehlavok" },
      { german:"das Schienbein", slovak:"hole≈à" },
      { german:"der Oberschenkel", slovak:"stehno" },
      { german:"der Oberschenkelknochen", slovak:"stehenn√° kos≈•" },
      { german:"die Wimpern", slovak:"mihalnice" },
      { german:"die Augenbraue", slovak:"oboƒçie" },
      { german:"aufzeichnen", slovak:"nahra≈•, zaznamena≈•" },
      { german:"die Witwe", slovak:"vdova" },
      { german:"Vorfahrt gew√§hren", slovak:"da≈• prednos≈• v jazde" },
      { german:"dauerhafte Folgen", slovak:"trval√© n√°sledky" },
      { german:"Erwerbsunf√§higkeitsrente", slovak:"invalidn√Ω d√¥chodok" },
      { german:"Kann ich aufgrund dauerhafter Folgen einen Antrag auf Erwerbsunf√§higkeitsrente stellen?", slovak:"M√¥≈æem po≈æiada≈• o invalidn√Ω d√¥chodok kv√¥li trval√Ωm n√°sledkom?" },
      { german:"Zinsen", slovak:"√∫roky" },
      { german:"Meine Finger und mein Handgelenk werden immer steifer und steifer", slovak:"Moje prsty a z√°p√§stie s√∫ ƒçoraz tuh≈°ie" },
      { german:"extrem ernste Bedrohung", slovak:"mimoriadne v√°≈æna hrozba" },
      { german:"gemobbt", slovak:"≈°ikanovan√Ω" },
      { german:"Gem√ºtlichkeit", slovak:"√∫tulnos≈•, pohoda" },
      { german:"Wovon ist das abh√§ngig?", slovak:"Na ƒçom to z√°vis√≠?" },
      { german:"√Ñrztlicher Bereitschaftsdienst", slovak:"lek√°rska pohotovostn√° slu≈æba" },
      { german:"Erleichterung", slovak:"√∫ƒæava" },
      { german:"Zuversicht", slovak:"d√¥vera, optimizmus" },
      { german:"Eine wundervolle und besinnliche Weihnachtszeit", slovak:"Kr√°sne a pokojn√© Vianoce" },
      { german:"Verpiss dich!", slovak:"Zmizni, stra≈• sa!" },
      { german:"Verpiss dich, du Wichser!", slovak:"Zmizni, ty kret√©n!" },
      { german:"Im Bett bist du eine Null! Selbst der beste Jockey kann nichts machen, wenn die Stute lahmt!", slovak:"V posteli si nula! Ani najlep≈°√≠ d≈æokej niƒç nezm√¥≈æe, keƒè kobyla kr√≠va!" },
      { german:"Schnall dich an!", slovak:"Zapni si p√°s!" },
      { german:"Herausforderung", slovak:"v√Ωzva" },
      { german:"Ich musste mich entscheiden", slovak:"Musel som sa rozhodn√∫≈•" },
      { german:"der Apfel", slovak:"jablko" },
      { german:"die Birne", slovak:"hru≈°ka" },
      { german:"die Pflaume", slovak:"slivka" },
      { german:"die Kirsche", slovak:"ƒçere≈°≈àa" },
      { german:"die Sauerkirsche", slovak:"vi≈°≈àa" },
      { german:"der Pfirsich", slovak:"brosky≈àa" },
      { german:"die Nektarine", slovak:"nektarinka" },
      { german:"die Aprikose", slovak:"marhuƒæa" },
      { german:"die Traube", slovak:"hrozno" },
      { german:"die Orange / die Apfelsine", slovak:"pomaranƒç" },
      { german:"die Mandarine", slovak:"mandar√≠nka" },
      { german:"die Zitrone", slovak:"citr√≥n" },
      { german:"die Grapefruit", slovak:"grep" },
      { german:"die Ananas", slovak:"anan√°s" },
      { german:"die Banane", slovak:"ban√°n" },
      { german:"die Kiwi", slovak:"kivi" },
      { german:"die Mango", slovak:"mango" },
      { german:"die Wassermelone", slovak:"ƒçerven√Ω mel√≥n" },
      { german:"die Honigmelone", slovak:"≈ælt√Ω mel√≥n" },
      { german:"die Erdbeere", slovak:"jahoda" },
      { german:"die Himbeere", slovak:"malina" },
      { german:"die Brombeere", slovak:"ƒçernica" },
      { german:"die Johannisbeere", slovak:"r√≠bezƒæa" },
      { german:"die Stachelbeere", slovak:"egre≈°" },
      { german:"der Granatapfel", slovak:"gran√°tov√© jablko" },
      { german:"die Feige", slovak:"figa" },
      { german:"die Dattel", slovak:"datƒæa" },
      { german:"die Limette", slovak:"limetka" },
      { german:"die Passionsfrucht", slovak:"marakuja" },
      { german:"die Kokosnuss", slovak:"kokosov√Ω orech" },
      { german:"die Avocado", slovak:"avok√°do" },
      { german:"im Gebet", slovak:"v modlitbe" },
      { german:"Deine Gnade", slovak:"tvoja milos≈•" },
      { german:"Barmherzigkeit", slovak:"milosrdenstvo" },
      { german:"f√ºr mich", slovak:"pre m≈àa" },
      { german:"alle Menschen", slovak:"v≈°etci ƒæudia" },
      { german:"die ich liebe", slovak:"ktor√Ωch milujem" },
      { german:"schenke", slovak:"daruj" },
      { german:"Mut", slovak:"odvaha" },
      { german:"Geduld", slovak:"trpezlivos≈•" },
      { german:"um ‚Ä¶ zu meistern", slovak:"aby som zvl√°dol" },
      { german:"Herausforderungen des Lebens", slovak:"v√Ωzvy ≈æivota" },
      { german:"meine Priorit√§ten zu setzen", slovak:"urƒçi≈• si priority" },
      { german:"mich zu konzentrieren", slovak:"s√∫stredi≈• sa" },
      { german:"auf das, was wirklich wichtig ist", slovak:"na to, ƒço je naozaj d√¥le≈æit√©" },
      { german:"Ich vertraue darauf", slovak:"D√¥verujem tomu" },
      { german:"dass Du immer bei mir bist", slovak:"≈æe si v≈ædy pri mne" },
      { german:"Ich verspreche", slovak:"Sƒæubujem" },
      { german:"R√ºhrei", slovak:"pra≈æenica" },
      { german:"Gro√ües Bier", slovak:"veƒæk√© pivo" },
      { german:"Spiegelei", slovak:"volsk√© oko" },
      { german:"Retouren / Retoure", slovak:"vr√°ten√Ω tovar" },
      { german:"Deutsche Lebens-Rettungs-Gesellschaft (DLRG)", slovak:"Nemeck√° spoloƒçnos≈• pre z√°chranu ≈æivota" },
      { german:"Rohrzucker", slovak:"trstinov√Ω cukor" },
      { german:"Fernweh", slovak:"t√∫≈æba po cestovan√≠" },
      { german:"Nachdem die Rechnung bezahlt worden war, wurde die Ware verschickt.", slovak:"Potom, ƒço bola fakt√∫ra zaplaten√°, bol tovar odoslan√Ω." },
      { german:"Ich wei√ü nicht, warum ich mich damit besch√§ftigen sollte.", slovak:"Neviem, preƒço by som sa t√Ωm mal zaobera≈•." },
      { german:"K√∂nnten Sie mir bitte n√§here Informationen mitteilen, damit ich Ihnen dabei helfen kann?", slovak:"Mohli by ste mi, pros√≠m, poskytn√∫≈• bli≈æ≈°ie inform√°cie, aby som v√°m mohol pom√¥c≈•?" },
      { german:"D√ºrfte ich Sie um n√§here Informationen √ºber diese Angelegenheit bitten?", slovak:"Smel by som v√°s po≈æiada≈• o bli≈æ≈°ie inform√°cie o tejto z√°le≈æitosti?" },
      { german:"die Fu√üsohle", slovak:"chodidlo, ploska nohy" },
      { german:"die Zehen", slovak:"prsty na nohe" },
      { german:"Benachrichtigungen aktivieren", slovak:"zapn√∫≈• upozornenia" },
      { german:"entsprechend", slovak:"zodpovedaj√∫ci" },
      { german:"Ich werde zur√ºckkehren", slovak:"Vr√°tim sa" },
      { german:"Ich bin pappsatt.", slovak:"Som √∫plne s√Ωty / prejeden√Ω" },
      { german:"Ich bin satt.", slovak:"Som s√Ωty" },
      { german:"Du hast meine Gedanken ausgesprochen.", slovak:"Povedal si presne to, ƒço som si myslel" },
      { german:"Ich bin fix und fertig.", slovak:"Som √∫plne vyƒçerpan√Ω" },
      { german:"Vorsichtig handhaben!", slovak:"Zach√°dzajte opatrne!" }
    ];

    // ===== Kapitola KPAK =====
    const kpakContent = [
      { german: "KPAK", slovak: "KPAK" },
      { german: "Wann?", slovak: "Kedy?" },
      { german: "Warum?", slovak: "Preƒço?" },
      { german: "Wie?", slovak: "Ako?" },
      { german: "Wo?", slovak: "Kde?" },
      { german: "Ich gehe", slovak: "Idem / P√¥jdem" },
      { german: "‚û°Ô∏è morgen", slovak: "‚û°Ô∏è zajtra" },
      { german: "‚û°Ô∏è wegen meiner Arbeit", slovak: "‚û°Ô∏è kv√¥li mojej pr√°ci" },
      { german: "‚û°Ô∏è mit dem Fahrrad", slovak: "‚û°Ô∏è na bicykli" },
      { german: "‚û°Ô∏è in die Stadt", slovak: "‚û°Ô∏è do mesta" },
      { german: "holen", slovak: "prinies≈•, z√°js≈• po (nieƒço/niekoho)" },
      { german: "Ich hole mir ein Glas Wasser.", slovak: "Idem si po poh√°r vody." },
      { german: "Kannst du die Zeitung holen?", slovak: "M√¥≈æe≈° prinies≈• noviny?" },
      { german: "abholen", slovak: "vyzdvihn√∫≈• (niekoho/nieƒço)" },
      { german: "Ich hole dich vom Bahnhof ab.", slovak: "Pr√≠dem ≈•a vyzdvihn√∫≈• na stanicu." },
      { german: "Er holt das Paket ab.", slovak: "Vyzdvihuje bal√≠k." },
      { german: "sich erholen", slovak: "odpoƒçin√∫≈• si, zotavi≈• sa" },
      { german: "Ich erhole mich am Wochenende.", slovak: "Odd√Ωchnem si cez v√≠kend." },
      { german: "Sie hat sich nach der Krankheit gut erholt.", slovak: "Dobre sa zotavila po chorobe." },
      { german: "durchn√§sst", slovak: "premoƒçen√Ω" },
      { german: "z√§hlen auf + Akkusativ", slovak: "spolieha≈• sa na niekoho" },
      { german: "Ich z√§hle auf dich.", slovak: "Spolieham sa na teba." },
      { german: "Du kannst auf mich z√§hlen.", slovak: "M√¥≈æe≈° sa na m≈àa spoƒæahn√∫≈•." },
      { german: "z√§hlen zu + Dativ", slovak: "patri≈• k nieƒçomu" },
      { german: "Er z√§hlt zu den Besten.", slovak: "Patr√≠ medzi najlep≈°√≠ch." },
      { german: "Das z√§hlt zu meinen Lieblingsb√ºchern.", slovak: "To patr√≠ medzi moje obƒæ√∫ben√© knihy." }
    ];

    // ===== APLIK√ÅCIA (stav a render) =====
    const appContent = document.getElementById('app-content');

    // Zl√∫ƒç z√°klad + u≈æ√≠vateƒæsk√© z localStorage (bez zmeny poradia z√°kladn√Ωch)
    const userVocab = loadUserVocab();
    const vocabularyList = [...BASE_VOCAB, ...userVocab];

    let currentWordIndex = 0;
    let showSlovak = false;
    let currentChapter = 'main';
    let kpakIndex = 0;

    // naƒç√≠tanie progresu (ulo≈æen√©ho v localStorage)
    loadProgress();

    // po naƒç√≠tan√≠ progresu ore≈æ indexy na platn√© rozsahy
    function clampProgressToRanges() {
      if (currentWordIndex < 0) currentWordIndex = 0;
      if (currentWordIndex >= vocabularyList.length) currentWordIndex = vocabularyList.length - 1;
      if (kpakIndex < 0) kpakIndex = 0;
      if (kpakIndex >= kpakContent.length) kpakIndex = kpakContent.length - 1;
      if (!Number.isFinite(currentWordIndex)) currentWordIndex = 0;
      if (!Number.isFinite(kpakIndex)) kpakIndex = 0;
    }
    clampProgressToRanges();

    const speakText = async (text, langShort) => {
      const lang = (langShort === 'de') ? 'de-DE' : 'sk-SK';
      await TTS.speak(text, lang);
    };

    const getNextWord = () => {
      showSlovak = false;
      if (currentChapter === 'main') {
        if (currentWordIndex >= vocabularyList.length) currentWordIndex = 0;
      } else {
        if (kpakIndex >= kpakContent.length) kpakIndex = 0;
      }
      saveProgress();
      render();
    };

    const handleReveal = () => { showSlovak = true; saveProgress(); render(); };
    const handleNext = () => {
      if (currentChapter === 'main') currentWordIndex++;
      else kpakIndex++;
      saveProgress();
      getNextWord();
    };
    const switchToKpak = () => { currentChapter = 'kpak'; kpakIndex = Math.max(0, kpakIndex|0); saveProgress(); getNextWord(); };
    const switchToMain = () => { currentChapter = 'main'; currentWordIndex = Math.max(0, currentWordIndex|0); saveProgress(); getNextWord(); };

    function render() {
      clampProgressToRanges();
      let currentContent;
      if (currentChapter === 'main') {
        if (currentWordIndex >= vocabularyList.length || currentWordIndex < 0) {
          appContent.innerHTML = `
            <div class="word-display">
              <p class="text-3xl font-extrabold text-white">Gratulujem!</p>
              <p class="text-xl font-semibold text-white mt-4">Pre≈°li ste v≈°etky slov√°.</p>
              <button id="restartBtn" class="button button-indigo mt-8">Zaƒça≈• odznova</button>
              <button id="switch-to-kpak-btn" class="button button-green mt-4">Prejs≈• na kapitolu KPAK</button>
            </div>`;
          document.getElementById('restartBtn').addEventListener('click', () => { currentWordIndex = 0; saveProgress(); getNextWord(); });
          document.getElementById('switch-to-kpak-btn').addEventListener('click', switchToKpak);
          return;
        }
        currentContent = vocabularyList[currentWordIndex];
      } else {
        if (kpakIndex >= kpakContent.length || kpakIndex < 0) {
          appContent.innerHTML = `
            <div class="word-display">
              <p class="text-3xl font-extrabold text-white">Koniec kapitoly KPAK!</p>
              <p class="text-xl font-semibold text-white mt-4">Pre≈°li ste v≈°etky slov√° z tejto sekcie.</p>
              <button id="back-to-main-btn" class="button button-indigo mt-8">N√°vrat k hlavn√©mu zoznamu</button>
              <button id="restartKpakBtn" class="button button-green mt-4">Zaƒça≈• odznova kapitolu KPAK</button>
            </div>`;
          document.getElementById('back-to-main-btn').addEventListener('click', switchToMain);
          document.getElementById('restartKpakBtn').addEventListener('click', () => { kpakIndex = 0; saveProgress(); getNextWord(); });
          return;
        }
        currentContent = kpakContent[kpakIndex];
      }

      let html = '';
      html += `<div class="word-display">`;
      html += `<p class="text-white text-4xl font-extrabold break-words max-w-full" style="user-select: text;">${currentContent.german}</p>`;
      html += `<button id="playGerman" class="speak-button button-blue">Prehra≈• v nemƒçine</button>`;
      html += `</div>`;

      if (showSlovak) {
        html += `<div class="slovak-display">
          <p class="text-white text-xl font-semibold break-words max-w-full" style="user-select: text;">${currentContent.slovak}</p>
          <button id="playSlovak" class="speak-button button-green">Prehra≈• v slovenƒçine</button>
        </div>`;
      }

      html += `<div class="flex flex-col space-y-3 mt-8">`;
      html += `<button id="revealBtn" class="button button-indigo">Zobrazi≈• preklad</button>`;
      html += `<button id="nextBtn" class="button button-red">ƒéal≈°ie slovo</button>`;

      if (currentChapter === 'main') {
        html += `<button id="switch-to-kpak-btn" class="button button-green mt-4">Prejs≈• na kapitolu KPAK</button>`;
      } else {
        html += `<button id="back-to-main-btn" class="button button-green mt-4">N√°vrat k hlavn√©mu zoznamu</button>`;
      }
      html += `</div>`;

      appContent.innerHTML = html;

      document.getElementById('playGerman').addEventListener('click', () => { speakText(currentContent.german, 'de'); });
      document.getElementById('nextBtn').addEventListener('click', () => { handleNext(); });
      document.getElementById('revealBtn').addEventListener('click', () => { handleReveal(); });

      if (showSlovak) {
        document.getElementById('playSlovak').addEventListener('click', () => { speakText(currentContent.slovak, 'sk'); });
      }

      if (currentChapter === 'main') {
        document.getElementById('switch-to-kpak-btn').addEventListener('click', switchToKpak);
      } else {
        document.getElementById('back-to-main-btn').addEventListener('click', switchToMain);
      }
    }

    // prv√© vykreslenie
    getNextWord();

    // ===== AUTO re≈æim (bez zmeny UI) =====
    const $ = (id)=>document.getElementById(id);
    const elStart = $("auto-start");
    const elPause = $("auto-pause");
    const elResume= $("auto-resume");
    const elStop  = $("auto-stop");
    const elPrev  = $("auto-prev");
    const elNext  = $("auto-next");
    const elStatus= $("auto-status");

    const st = {
      running:false, paused:false,
      get list(){ return currentChapter === 'main' ? vocabularyList : kpakContent; },
      get i(){ return currentChapter === 'main' ? currentWordIndex : kpakIndex; },
      set i(v){ if (currentChapter === 'main') currentWordIndex = v; else kpakIndex = v; saveProgress(); render(); }
    };

    function setBtns(){
      elStart.disabled  = st.running;
      elPause.disabled  = !st.running || st.paused;
      elResume.disabled = !st.running || !st.paused;
      elStop.disabled   = !st.running;
      elPrev.disabled   = !st.running;
      elNext.disabled   = !st.running;
    }
    function status(t){ elStatus.textContent = t; }

    async function playItem(i){
      const item = st.list[i];
      if (!item) return false;
      status(`üîä DE: ${item.german}`);
      await TTS.speak(item.german, 'de-DE');
      if (!st.running) return false;
      showSlovak = true; saveProgress(); render();
      status(`üîä SK: ${item.slovak}`);
      await TTS.speak(item.slovak, 'sk-SK');
      return true;
    }

    async function loop(){
      setBtns();
      while (st.running){
        if (st.paused) { await new Promise(r=>setTimeout(r,120)); continue; }
        const ok = await playItem(st.i);
        if (!ok || !st.running) break;
        st.i++;
        if (st.i >= st.list.length) {
          if (currentChapter === 'main' && kpakContent.length) {
            currentChapter = 'kpak';
            st.i = 0;
            showSlovak = false; saveProgress(); render();
            continue;
          } else {
            stopAuto();
            break;
          }
        }
        showSlovak = false; saveProgress(); render();
      }
    }

    function startAuto(){
      currentChapter = 'main';
      currentWordIndex = 0;
      kpakIndex = 0;
      st.running = true; st.paused = false;
      status("Auto re≈æim be≈æ√≠‚Ä¶");
      setBtns();
      saveProgress();
      loop();
    }
    function stopAuto(){
      st.running = false; st.paused = false;
      TTS.cancel();
      status("Zastaven√©.");
      setBtns();
      saveProgress();
    }
    function pauseAuto(){
      st.paused = true;
      try { speechSynthesis.pause(); } catch{}
      status("Pauza.");
      setBtns();
      saveProgress();
    }
    function resumeAuto(){
      st.paused = false;
      try { speechSynthesis.resume(); } catch{}
      status("Pokraƒçujem‚Ä¶");
      setBtns();
      saveProgress();
    }
    function prevOne(){
      if (!st.running) return;
      st.i = Math.max(0, st.i - 1);
      TTS.cancel();
      saveProgress();
    }
    function nextOne(){
      if (!st.running) return;
      st.i = Math.min(st.list.length - 1, st.i + 1);
      TTS.cancel();
      saveProgress();
    }

    elStart.addEventListener('click', startAuto);
    elStop .addEventListener('click', stopAuto);
    elPause.addEventListener('click', pauseAuto);
    elResume.addEventListener('click', resumeAuto);
    elPrev .addEventListener('click', prevOne);
    elNext .addEventListener('click', nextOne);

    // ===== FORMUL√ÅR: pridanie slova + ukladanie do localStorage =====
    const formBox = document.createElement('div');
    formBox.className = "panel";
    formBox.innerHTML = `
      <h2 class="text-xl font-bold mb-4">Pridaj nov√© slov√≠ƒçko</h2>
      <input id="newGerman" type="text" placeholder="Nemeck√© slovo" class="border p-2 rounded w-full mb-2">
      <input id="newSlovak" type="text" placeholder="Slovensk√Ω preklad" class="border p-2 rounded w-full mb-2">
      <button id="addWordBtn" class="button button-green w-full">Prida≈• slovo</button>
    `;
    document.querySelector(".container").appendChild(formBox);

    document.getElementById('addWordBtn').addEventListener('click', () => {
      const german = document.getElementById('newGerman').value.trim();
      const slovak = document.getElementById('newSlovak').value.trim();
      if (!german || !slovak) return;

      // ulo≈æenie do runtime zoznamu (zachov√° dizajn/logiku)
      vocabularyList.push({ german, slovak });

      // ulo≈æenie do localStorage (iba novinky, neniƒç√≠ existuj√∫ce)
      const fresh = loadUserVocab();
      fresh.push({ german, slovak });
      saveUserVocab(fresh);

      alert("Slovo bolo pridan√© (ulo≈æen√© lok√°lne).");
      document.getElementById('newGerman').value = "";
      document.getElementById('newSlovak').value = "";
      saveProgress();
    });

    // ===== Service worker (offline podpora) =====
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/nemecky-jazyk/sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
