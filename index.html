<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Precvičovanie nemčiny</title>

  <!-- PWA META -->
  <meta name="theme-color" content="#4f46e5" />
  <link rel="manifest" href="/nemecky-jazyk/manifest.webmanifest" />
  <link rel="apple-touch-icon" href="/nemecky-jazyk/icon.png">

  <!-- Tailwind + fonty -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f1f5f9;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
      box-sizing: border-box;
      user-select: auto;
    }
    .container {
      background-color: #f87171;
      border-radius: 1.5rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      padding: 2rem;
      max-width: 600px;
      width: 100%;
      text-align: center;
      border: 4px solid #818cf8;
    }
    .button {
      padding: 0.75rem 2rem;
      font-weight: bold;
      border-radius: 9999px;
      color: white;
      transition: all 0.2s ease-in-out;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .button-indigo { background-color: #4f46e5; }
    .button-indigo:hover { background-color: #4338ca; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button-green { background-color: #22c55e; }
    .button-green:hover { background-color: #16a34a; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button-blue { background-color: #3b82f6; }
    .button-blue:hover { background-color: #2563eb; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button-red { background-color: #ef4444; }
    .button-red:hover { background-color: #dc2626; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button:disabled { background-color: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }
    .word-display { min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .slovak-display { min-height: 50px; margin-top: 1rem; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .speak-button {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 0.5rem 1rem; font-weight: bold; border-radius: 9999px;
      color: white; transition: all 0.2s ease-in-out; cursor: pointer; margin-top: 0.5rem;
    }
    .speak-button:disabled { background-color: #cbd5e1; cursor: not-allowed; color: #64748b; }
    .credits-box { background-color: #d1fae5; border: 2px solid #34d399; border-radius: 0.5rem; padding: 1rem; margin-top: 2rem; text-align: center; }
    .credits-text { color: #7c3aed; font-weight: bold; }
    .panel { background:#fff;border:2px solid #818cf8;border-radius:1rem;padding:1rem;margin-bottom:1rem }
    .row { display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;align-items:center }
    .muted { opacity:.85 }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-3xl font-bold text-slate-800 mb-6">Precvičovanie nemčiny</h1>

    <!-- Panel automatického prehrávania -->
    <div class="panel">
      <div class="row">
        <button id="auto-start"  class="button button-green">▶️ Spustiť auto</button>
        <button id="auto-pause"  class="button button-indigo" disabled>⏸️ Pauza</button>
        <button id="auto-resume" class="button button-indigo" disabled>▶️ Pokračovať</button>
        <button id="auto-stop"   class="button button-red"    disabled>⏹️ Stop</button>
        <button id="auto-prev"   class="button button-blue"   disabled>⏮️ Predošlé</button>
        <button id="auto-next"   class="button button-blue"   disabled>⏭️ Ďalšie</button>
      </div>
      <div id="auto-status" class="muted" style="margin-top:.5rem;text-align:left">Pripravené…</div>
    </div>

    <div id="app-content"></div>

    <div class="credits-box">
      <span class="credits-text">Vytvoril: Ivan Kebra Nagast</span>
    </div>
  </div>

  <script>
    // ===== Ukladanie do localStorage =====
    const LS_KEY = 'nemeckyVocabV1';          // užívateľom pridané slová
    const PROG_KEY = 'nemeckyProgressV1';     // progres: kapitola + indexy

    function loadUserVocab() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr.filter(x => x && x.german && x.slovak) : [];
      } catch { return []; }
    }
    function saveUserVocab(list) {
      try { localStorage.setItem(LS_KEY, JSON.stringify(list)); } catch {}
    }

    function saveProgress() {
      try {
        const data = {
          chapter: currentChapter,          // 'main' | 'kpak'
          mainIndex: currentWordIndex|0,
          kpakIndex: kpakIndex|0,
          showSlovak: !!showSlovak
        };
        localStorage.setItem(PROG_KEY, JSON.stringify(data));
      } catch {}
    }
    function loadProgress() {
      try {
        const raw = localStorage.getItem(PROG_KEY);
        if (!raw) return;
        const d = JSON.parse(raw) || {};
        if (d.chapter === 'kpak' || d.chapter === 'main') currentChapter = d.chapter;
        if (Number.isInteger(d.mainIndex)) currentWordIndex = d.mainIndex;
        if (Number.isInteger(d.kpakIndex)) kpakIndex = d.kpakIndex;
        showSlovak = !!d.showSlovak;
      } catch {}
    }

    // ===== TTS engine =====
    const TTS = (() => {
      const synth = window.speechSynthesis;
      function pickVoiceByLang(lang, preferNames = []) {
        const list = (synth.getVoices() || []).filter(v => (v.lang || "").toLowerCase().startsWith(lang.toLowerCase()));
        if (!list.length) return null;
        for (const name of preferNames) {
          const hit = list.find(v => (v.name || "").toLowerCase().includes(name.toLowerCase()));
          if (hit) return hit;
        }
        return list[0] || null;
      }
      async function speak(text, langCode) {
        if (!('speechSynthesis' in window)) return;
        const u = new SpeechSynthesisUtterance(String(text));
        u.lang = langCode;
        const prefer = langCode === "de-DE" ? ["Anna","Markus","Katja","Yannick"] : ["Laura","Zuzana","Filip","Ján"];
        const voice = pickVoiceByLang(langCode, prefer);
        if (voice) u.voice = voice;
        u.rate = 1.0; u.pitch = 1.0; u.volume = 1.0;
        return new Promise(res => {
          try {
            synth.cancel();
            u.onend = res; u.onerror = res;
            synth.speak(u);
          } catch { res(); }
        });
      }
      return { speak, cancel(){ try{ speechSynthesis.cancel(); }catch{} } };
    })();

    // ===== OPRAVENÝ ZÁKLADNÝ ZOZNAM SLOVÍČOK =====
    const BASE_VOCAB = [
      { german:"Vermutung", slovak:"domnienka, tušenie" },
      { german:"Vermögen", slovak:"majetok, schopnosť" },
      { german:"das Äußerste", slovak:"najkrajnejšie; krajnosť" },
      { german:"die Ankündigung", slovak:"oznámenie, ohlásenie" },
      { german:"Fahrgestell", slovak:"podvozok" },
      { german:"schätzen", slovak:"oceniť" },
      { german:"loslassen", slovak:"nechať ísť, pustiť" },
      { german:"loszulassen", slovak:"nepustiť, nikdy nenechať ísť" },
      { german:"zusammenkommen", slovak:"dať sa dokopy, stretnúť sa" },
      { german:"auseinander", slovak:"od seba" },
      { german:"ein bisschen auseinanderstehen", slovak:"stáť trochu od seba" },
      { german:"sich auseinanderentwickeln", slovak:"odcudziť sa; rozišli sa ich cesty",priklad:"Die beiden Freunde haben sich auseinanderentwickelt. → Tí dvaja priatelia sa odcudzili / ich cesty sa rozišli."},
      { german:"begegnen", slovak:"stretnúť (sa s niekým)" },
      { german:"begegnet", slovak:"stretol (sa)" },
      { german:"der Zweifel", slovak:"pochybnosť" },
      { german:"der Leichnam", slovak:"mŕtvola" },
      { german:"mitmachen", slovak:"zúčastniť sa, pridať sa" },
      { german:"Ja, ich mache mit", slovak:"Áno, pridám sa; Áno, zúčastním sa" },
      { german:"Ja, ich werde mitmachen", slovak:"Áno, zúčastním sa (v budúcnosti)" },
      { german:"Ja, ich schließe mich an", slovak:"Áno, pripájam sa" },
      { german:"Rinderfilet", slovak:"hovädzia sviečkovica" },
      { german:"Auftragsverfolgung", slovak:"sledovanie objednávky" },
      { german:"der Scherz", slovak:"žart" },
      { german:"die Zuversicht", slovak:"nádej, dôvera, viera" },
      { german:"abschließen", slovak:"zamknúť; uzavrieť" },
      { german:"aufschließen", slovak:"odomknúť" },
      { german:"Ich möchte mich gerne nach der Miete erkundigen", slovak:"Chcel by som sa opýtať na nájomné" },
      { german:"der Bluterguss", slovak:"modrina" },
      { german:"die Narbe", slovak:"jazva" },
      { german:"der Ausschlag", slovak:"vyrážka" },
      { german:"die Schnittwunde", slovak:"porezanie" },
      { german:"der Splitter", slovak:"trieska" },
      { german:"Glühwürmchen", slovak:"svetluška" },
      { german:"Einrichtungshaus", slovak:"obchod s nábytkom" },
      { german:"bewirkt", slovak:"spôsobí" },
      { german:"Erwachen", slovak:"prebudenie" },
      { german:"Arbeitsunfähigkeitsbescheinigung", slovak:"potvrdenie o práceneschopnosti (PN)" },
      { german:"Schuhe anziehen", slovak:"obuť si topánky" },
      { german:"Schuhe ausziehen", slovak:"vyzuť si topánky" },
      { german:"sich anziehen", slovak:"obliecť sa" },
      { german:"sich ausziehen", slovak:"vyzliecť sa" },
      { german:"Zieh deine Schuhe aus!", slovak:"Vyzuj si topánky!" },
      { german:"Zieh deine Sachen aus!", slovak:"Vyzleč si veci!" },
      { german:"Zieh dich aus!", slovak:"Vyzleč sa!" },
      { german:"Zieh dich aus, Baby!", slovak:"Vyzleč sa, zlatko!" },
      { german:"übergeben", slovak:"odovzdať" },
      { german:"Ich betrachte das als eine Lüge", slovak:"Považujem to za lož" },
      { german:"Schäm dich, so zu lügen!", slovak:"Hanbi sa, že takto klameš!" },
      { german:"Gott segne dich", slovak:"Boh ti žehnaj" },
      { german:"Kartoffeln schälen und würfeln", slovak:"Zemiaky ošúpeme a nakrájame na kocky" },
      { german:"Nebelhorn", slovak:"hmlovka" },
      { german:"Schweinshaxe", slovak:"bravčové koleno" },
      { german:"So habe ich das nie gesagt! Du drehst mir immer das Wort im Munde herum!", slovak:"Nikdy som to tak nepovedal, vždy prekrúcaš moje slová!" },
      { german:"Luftabwehr", slovak:"protivzdušná obrana" },
      { german:"Gehirnerschütterung", slovak:"otras mozgu" },
      { german:"Beinbruch", slovak:"zlomená noha" },
      { german:"Krankenhausaufenthalt", slovak:"hospitalizácia" },
      { german:"Ich bin im Reinen mit mir", slovak:"Som so sebou vyrovnaný" },
      { german:"Notaufnahme", slovak:"pohotovostný príjem" },
      { german:"Zinssatz", slovak:"úroková sadzba" },
      { german:"Jahrzehnte", slovak:"desaťročia" },
      { german:"LG / Liebe Grüße", slovak:"S pozdravom, srdečné pozdravy" },
      { german:"Wer bist du?", slovak:"Kto si ty?" },
      { german:"Ich wünschte, zwischen uns wäre etwas", slovak:"Prial by som si, aby medzi nami niečo bolo" },
      { german:"Vogelgezwitscher", slovak:"vtáčí spev, štebotanie" },
      { german:"Verkehrssituation", slovak:"dopravná situácia" },
      { german:"Tränensäcke", slovak:"vaky pod očami" },
      { german:"Inwiefern stimmen Sie den folgenden Aussagen zu?", slovak:"Do akej miery súhlasíte s nasledujúcimi tvrdeniami?" },
      { german:"Bin unentschieden", slovak:"Nie som rozhodnutý" },
      { german:"Gelegentlich", slovak:"príležitostne" },
      { german:"Lass dich nicht unterkriegen!", slovak:"Nenechaj sa zlomiť! Nepoddaj sa!" },
      { german:"das Magengeschwür", slovak:"žalúdočný vred" },
      { german:"Befreiung von der Zuzahlung", slovak:"oslobodenie od poplatku za spoluúčasť" },
      { german:"Das Leben ist wirklich hart, wir müssen ständig kämpfen, und wir bekommen das Wichtigste nicht, nämlich die Liebe.", slovak:"Život je ťažký, musíme stále bojovať a nedostáva sa nám toho najdôležitejšieho – lásky." },
      { german:"Folsäure", slovak:"kyselina listová" },
      { german:"abgehauen", slovak:"ujsť, zmiznúť" },
      { german:"Meine Gesundheit macht mir im Moment zu schaffen", slovak:"Moje zdravie mi teraz robí problémy" },
      { german:"Liegestütze", slovak:"kliky" },
      { german:"Engagiert sich für die Einhaltung der Menschenrechte entlang seiner Lieferkette", slovak:"Zaviazali sa dodržiavať ľudské práva v rámci dodávateľského reťazca" },
      { german:"Im Folgenden geht es um das Thema Alltag", slovak:"Nasledujúci text sa týka každodenného života" },
      { german:"Vollzeit erwerbstätig", slovak:"zamestnaný na plný úväzok" },
      { german:"beugen", slovak:"ohnúť" },
      { german:"strecken", slovak:"narovnať, natiahnuť" },
      { german:"Spreiz deine Beine!", slovak:"Roztiahni nohy!" },
      { german:"Grätsche die Beine!", slovak:"Roztiahni nohy doširoka!" },
      { german:"Verwechsle vier Dinge nicht: Höflichkeit ist kein Flirten, Aufmerksamkeit ist keine Liebe, Schweigen ist kein Ärger, und Tränen sind keine Schwäche.", slovak:"Nezamieňaj si štyri veci: zdvorilosť nie je flirtovanie, pozornosť nie je láska, mlčanie nie je hnev a slzy nie sú slabosť." },
      { german:"widerlich", slovak:"odporný, hnusný" },
      { german:"Abfindung", slovak:"odstupné" },
      { german:"Verkehrsunfall wegen eines Rasers", slovak:"dopravná nehoda kvôli rýchlej jazde (vinníkom je „rýchlikár“)" },
      { german:"Regierungschef", slovak:"vedúci predstaviteľ vlády" },
      { german:"Premierminister", slovak:"predseda vlády" },
      { german:"Krampfadern (Varizen)", slovak:"kŕčové žily" },
      { german:"Ich war gestern nicht gut drauf", slovak:"Včera som nemal dobrú náladu" },
      { german:"Ärztliche Bereitschaftspraxis", slovak:"lekárska pohotovosť" },
      { german:"Wertstoffhof", slovak:"zberný dvor, recyklačné centrum" },
      { german:"Kiefer brechen", slovak:"zlomiť čeľusť" },
      { german:"Wiedereingliederung", slovak:"znovuzaradenie, reintegrácia" },
      { german:"Spine Massager", slovak:"masážny prístroj na chrbticu" },
      { german:"Kommt mir bekannt vor", slovak:"zdá sa mi to známe" },
      { german:"Das Handgelenk lockert sich langsam", slovak:"Zápästie sa pomaly uvoľňuje" },
      { german:"Gerichtsvollzieher", slovak:"súdny exekútor" },
      { german:"Ich gehe aus", slovak:"Idem von / Idem preč" },
      { german:"rund um die Uhr", slovak:"nonstop" },
      { german:"Voraussichtliche Zustellung", slovak:"odhadované doručenie" },
      { german:"krankheitsbedingt", slovak:"z dôvodu choroby" },
      { german:"Lob sei Gott", slovak:"Chvála Bohu" },
      { german:"Gott sei Dank", slovak:"Vďaka Bohu" },
      { german:"Erzieherin", slovak:"vychovávateľka" },
      { german:"je", slovak:"čím" },
      { german:"desto", slovak:"tým" },
      { german:"Wurst", slovak:"klobása, údenina" },
      { german:"Blutwurst / Grützwurst", slovak:"jaternica / krvavnica" },
      { german:"Würstchen", slovak:"párky" },
      { german:"Bratwürstchen", slovak:"špekačky, malé klobásky" },
      { german:"Paketzusteller", slovak:"doručovateľ balíkov, kuriér" },

      { german:"Bei einer jungen Frau geht der Schwanz kaputt, aber bei einer alten Frau kann man gut üben.", slovak:"Na mladej žene sa kokot ničí, na starej žene sa dobre cvičí" },

      { german:"Höschen", slovak:"nohavičky" },
      { german:"das Gleis", slovak:"koľaj, nástupište" },
      { german:"die Schiene", slovak:"dlaha, ortéza; koľajnica" },
      { german:"die Strecke", slovak:"trať, trasa, vzdialenosť" },
      { german:"Gesellschaft mit beschränkter Haftung (GmbH)", slovak:"spoločnosť s ručením obmedzeným (s.r.o.)" },
      { german:"sich schämen", slovak:"hanbiť sa" },
      { german:"empfehlen", slovak:"odporučiť" },
      { german:"Wunder", slovak:"zázrak" },
      { german:"teilnehmen", slovak:"zúčastniť sa" },
      { german:"Er hat mir gesagt, dass meine Schulter anfängt zu vernarben", slovak:"Povedal mi, že rameno sa začína zjazvovať" },
      { german:"die Stirn", slovak:"čelo" },
      { german:"die Ferse", slovak:"päta" },
      { german:"die Handfläche", slovak:"dlaň" },
      { german:"der Fußrücken", slovak:"priehlavok" },
      { german:"das Schienbein", slovak:"holeň" },
      { german:"der Oberschenkel", slovak:"stehno" },
      { german:"der Oberschenkelknochen", slovak:"stehenná kosť" },
      { german:"die Wimpern", slovak:"mihalnice" },
      { german:"die Augenbraue", slovak:"obočie" },
      { german:"aufzeichnen", slovak:"nahrať, zaznamenať" },
      { german:"die Witwe", slovak:"vdova" },
      { german:"Vorfahrt gewähren", slovak:"dať prednosť v jazde" },
      { german:"dauerhafte Folgen", slovak:"trvalé následky" },
      { german:"Erwerbsunfähigkeitsrente", slovak:"invalidný dôchodok" },
      { german:"Kann ich aufgrund dauerhafter Folgen einen Antrag auf Erwerbsunfähigkeitsrente stellen?", slovak:"Môžem požiadať o invalidný dôchodok kvôli trvalým následkom?" },
      { german:"Zinsen", slovak:"úroky" },
      { german:"Meine Finger und mein Handgelenk werden immer steifer und steifer", slovak:"Moje prsty a zápästie sú čoraz tuhšie" },
      { german:"extrem ernste Bedrohung", slovak:"mimoriadne vážna hrozba" },
      { german:"gemobbt", slovak:"šikanovaný" },
      { german:"Gemütlichkeit", slovak:"útulnosť, pohoda" },
      { german:"Wovon ist das abhängig?", slovak:"Na čom to závisí?" },
      { german:"Ärztlicher Bereitschaftsdienst", slovak:"lekárska pohotovostná služba" },
      { german:"Erleichterung", slovak:"úľava" },
      { german:"Zuversicht", slovak:"dôvera, optimizmus" },
      { german:"Eine wundervolle und besinnliche Weihnachtszeit", slovak:"Krásne a pokojné Vianoce" },
      { german:"Verpiss dich!", slovak:"Zmizni, strať sa!" },
      { german:"Verpiss dich, du Wichser!", slovak:"Zmizni, ty kretén!" },
      { german:"Im Bett bist du eine Null! Selbst der beste Jockey kann nichts machen, wenn die Stute lahmt!", slovak:"V posteli si nula! Ani najlepší džokej nič nezmôže, keď kobyla kríva!" },
      { german:"Schnall dich an!", slovak:"Zapni si pás!" },
      { german:"Herausforderung", slovak:"výzva" },
      { german:"Ich musste mich entscheiden", slovak:"Musel som sa rozhodnúť" },
      { german:"der Apfel", slovak:"jablko" },
      { german:"die Birne", slovak:"hruška" },
      { german:"die Pflaume", slovak:"slivka" },
      { german:"die Kirsche", slovak:"čerešňa" },
      { german:"die Sauerkirsche", slovak:"višňa" },
      { german:"der Pfirsich", slovak:"broskyňa" },
      { german:"die Nektarine", slovak:"nektarinka" },
      { german:"die Aprikose", slovak:"marhuľa" },
      { german:"die Traube", slovak:"hrozno" },
      { german:"die Orange / die Apfelsine", slovak:"pomaranč" },
      { german:"die Mandarine", slovak:"mandarínka" },
      { german:"die Zitrone", slovak:"citrón" },
      { german:"die Grapefruit", slovak:"grep" },
      { german:"die Ananas", slovak:"ananás" },
      { german:"die Banane", slovak:"banán" },
      { german:"die Kiwi", slovak:"kivi" },
      { german:"die Mango", slovak:"mango" },
      { german:"die Wassermelone", slovak:"červený melón" },
      { german:"die Honigmelone", slovak:"žltý melón" },
      { german:"die Erdbeere", slovak:"jahoda" },
      { german:"die Himbeere", slovak:"malina" },
      { german:"die Brombeere", slovak:"černica" },
      { german:"die Johannisbeere", slovak:"ríbezľa" },
      { german:"die Stachelbeere", slovak:"egreš" },
      { german:"der Granatapfel", slovak:"granátové jablko" },
      { german:"die Feige", slovak:"figa" },
      { german:"die Dattel", slovak:"datľa" },
      { german:"die Limette", slovak:"limetka" },
      { german:"die Passionsfrucht", slovak:"marakuja" },
      { german:"die Kokosnuss", slovak:"kokosový orech" },
      { german:"die Avocado", slovak:"avokádo" },
      { german:"im Gebet", slovak:"v modlitbe" },
      { german:"Deine Gnade", slovak:"tvoja milosť" },
      { german:"Barmherzigkeit", slovak:"milosrdenstvo" },
      { german:"für mich", slovak:"pre mňa" },
      { german:"alle Menschen", slovak:"všetci ľudia" },
      { german:"die ich liebe", slovak:"ktorých milujem" },
      { german:"schenke", slovak:"daruj" },
      { german:"Mut", slovak:"odvaha" },
      { german:"Geduld", slovak:"trpezlivosť" },
      { german:"um … zu meistern", slovak:"aby som zvládol" },
      { german:"Herausforderungen des Lebens", slovak:"výzvy života" },
      { german:"meine Prioritäten zu setzen", slovak:"určiť si priority" },
      { german:"mich zu konzentrieren", slovak:"sústrediť sa" },
      { german:"auf das, was wirklich wichtig ist", slovak:"na to, čo je naozaj dôležité" },
      { german:"Ich vertraue darauf", slovak:"Dôverujem tomu" },
      { german:"dass Du immer bei mir bist", slovak:"že si vždy pri mne" },
      { german:"Ich verspreche", slovak:"Sľubujem" },
      { german:"Rührei", slovak:"praženica" },
      { german:"Großes Bier", slovak:"veľké pivo" },
      { german:"Spiegelei", slovak:"volské oko" },
      { german:"Retouren / Retoure", slovak:"vrátený tovar" },
      { german:"Deutsche Lebens-Rettungs-Gesellschaft (DLRG)", slovak:"Nemecká spoločnosť pre záchranu života" },
      { german:"Rohrzucker", slovak:"trstinový cukor" },
      { german:"Fernweh", slovak:"túžba po cestovaní" },
      { german:"Nachdem die Rechnung bezahlt worden war, wurde die Ware verschickt.", slovak:"Potom, čo bola faktúra zaplatená, bol tovar odoslaný." },
      { german:"Ich weiß nicht, warum ich mich damit beschäftigen sollte.", slovak:"Neviem, prečo by som sa tým mal zaoberať." },
      { german:"Könnten Sie mir bitte nähere Informationen mitteilen, damit ich Ihnen dabei helfen kann?", slovak:"Mohli by ste mi, prosím, poskytnúť bližšie informácie, aby som vám mohol pomôcť?" },
      { german:"Dürfte ich Sie um nähere Informationen über diese Angelegenheit bitten?", slovak:"Smel by som vás požiadať o bližšie informácie o tejto záležitosti?" },
      { german:"die Fußsohle", slovak:"chodidlo, ploska nohy" },
      { german:"die Zehen", slovak:"prsty na nohe" },
      { german:"Benachrichtigungen aktivieren", slovak:"zapnúť upozornenia" },
      { german:"entsprechend", slovak:"zodpovedajúci" },
      { german:"Ich werde zurückkehren", slovak:"Vrátim sa" },
      { german:"Ich bin pappsatt.", slovak:"Som úplne sýty / prejedený" },
      { german:"Ich bin satt.", slovak:"Som sýty" },
      { german:"Du hast meine Gedanken ausgesprochen.", slovak:"Povedal si presne to, čo som si myslel" },
      { german:"Ich bin fix und fertig.", slovak:"Som úplne vyčerpaný" },
      { german:"Vorsichtig handhaben!", slovak:"Zachádzajte opatrne!" }
    ];

    // ===== Kapitola KPAK =====
    const kpakContent = [
      { german: "KPAK", slovak: "KPAK" },
      { german: "Wann?", slovak: "Kedy?" },
      { german: "Warum?", slovak: "Prečo?" },
      { german: "Wie?", slovak: "Ako?" },
      { german: "Wo?", slovak: "Kde?" },
      { german: "Ich gehe", slovak: "Idem / Pôjdem" },
      { german: "➡️ morgen", slovak: "➡️ zajtra" },
      { german: "➡️ wegen meiner Arbeit", slovak: "➡️ kvôli mojej práci" },
      { german: "➡️ mit dem Fahrrad", slovak: "➡️ na bicykli" },
      { german: "➡️ in die Stadt", slovak: "➡️ do mesta" },
      { german: "holen", slovak: "priniesť, zájsť po (niečo/niekoho)" },
      { german: "Ich hole mir ein Glas Wasser.", slovak: "Idem si po pohár vody." },
      { german: "Kannst du die Zeitung holen?", slovak: "Môžeš priniesť noviny?" },
      { german: "abholen", slovak: "vyzdvihnúť (niekoho/niečo)" },
      { german: "Ich hole dich vom Bahnhof ab.", slovak: "Prídem ťa vyzdvihnúť na stanicu." },
      { german: "Er holt das Paket ab.", slovak: "Vyzdvihuje balík." },
      { german: "sich erholen", slovak: "odpočinúť si, zotaviť sa" },
      { german: "Ich erhole mich am Wochenende.", slovak: "Oddýchnem si cez víkend." },
      { german: "Sie hat sich nach der Krankheit gut erholt.", slovak: "Dobre sa zotavila po chorobe." },
      { german: "durchnässt", slovak: "premočený" },
      { german: "zählen auf + Akkusativ", slovak: "spoliehať sa na niekoho" },
      { german: "Ich zähle auf dich.", slovak: "Spolieham sa na teba." },
      { german: "Du kannst auf mich zählen.", slovak: "Môžeš sa na mňa spoľahnúť." },
      { german: "zählen zu + Dativ", slovak: "patriť k niečomu" },
      { german: "Er zählt zu den Besten.", slovak: "Patrí medzi najlepších." },
      { german: "Das zählt zu meinen Lieblingsbüchern.", slovak: "To patrí medzi moje obľúbené knihy." }
    ];

    // ===== APLIKÁCIA (stav a render) =====
    const appContent = document.getElementById('app-content');

    // Zlúč základ + užívateľské z localStorage (bez zmeny poradia základných)
    const userVocab = loadUserVocab();
    const vocabularyList = [...BASE_VOCAB, ...userVocab];

    let currentWordIndex = 0;
    let showSlovak = false;
    let currentChapter = 'main';
    let kpakIndex = 0;

    // načítanie progresu (uloženého v localStorage)
    loadProgress();

    // po načítaní progresu orež indexy na platné rozsahy
    function clampProgressToRanges() {
      if (currentWordIndex < 0) currentWordIndex = 0;
      if (currentWordIndex >= vocabularyList.length) currentWordIndex = vocabularyList.length - 1;
      if (kpakIndex < 0) kpakIndex = 0;
      if (kpakIndex >= kpakContent.length) kpakIndex = kpakContent.length - 1;
      if (!Number.isFinite(currentWordIndex)) currentWordIndex = 0;
      if (!Number.isFinite(kpakIndex)) kpakIndex = 0;
    }
    clampProgressToRanges();

    const speakText = async (text, langShort) => {
      const lang = (langShort === 'de') ? 'de-DE' : 'sk-SK';
      await TTS.speak(text, lang);
    };

    const getNextWord = () => {
      showSlovak = false;
      if (currentChapter === 'main') {
        if (currentWordIndex >= vocabularyList.length) currentWordIndex = 0;
      } else {
        if (kpakIndex >= kpakContent.length) kpakIndex = 0;
      }
      saveProgress();
      render();
    };

    const handleReveal = () => { showSlovak = true; saveProgress(); render(); };
    const handleNext = () => {
      if (currentChapter === 'main') currentWordIndex++;
      else kpakIndex++;
      saveProgress();
      getNextWord();
    };
    const switchToKpak = () => { currentChapter = 'kpak'; kpakIndex = Math.max(0, kpakIndex|0); saveProgress(); getNextWord(); };
    const switchToMain = () => { currentChapter = 'main'; currentWordIndex = Math.max(0, currentWordIndex|0); saveProgress(); getNextWord(); };

    function render() {
      clampProgressToRanges();
      let currentContent;
      if (currentChapter === 'main') {
        if (currentWordIndex >= vocabularyList.length || currentWordIndex < 0) {
          appContent.innerHTML = `
            <div class="word-display">
              <p class="text-3xl font-extrabold text-white">Gratulujem!</p>
              <p class="text-xl font-semibold text-white mt-4">Prešli ste všetky slová.</p>
              <button id="restartBtn" class="button button-indigo mt-8">Začať odznova</button>
              <button id="switch-to-kpak-btn" class="button button-green mt-4">Prejsť na kapitolu KPAK</button>
            </div>`;
          document.getElementById('restartBtn').addEventListener('click', () => { currentWordIndex = 0; saveProgress(); getNextWord(); });
          document.getElementById('switch-to-kpak-btn').addEventListener('click', switchToKpak);
          return;
        }
        currentContent = vocabularyList[currentWordIndex];
      } else {
        if (kpakIndex >= kpakContent.length || kpakIndex < 0) {
          appContent.innerHTML = `
            <div class="word-display">
              <p class="text-3xl font-extrabold text-white">Koniec kapitoly KPAK!</p>
              <p class="text-xl font-semibold text-white mt-4">Prešli ste všetky slová z tejto sekcie.</p>
              <button id="back-to-main-btn" class="button button-indigo mt-8">Návrat k hlavnému zoznamu</button>
              <button id="restartKpakBtn" class="button button-green mt-4">Začať odznova kapitolu KPAK</button>
            </div>`;
          document.getElementById('back-to-main-btn').addEventListener('click', switchToMain);
          document.getElementById('restartKpakBtn').addEventListener('click', () => { kpakIndex = 0; saveProgress(); getNextWord(); });
          return;
        }
        currentContent = kpakContent[kpakIndex];
      }

      let html = '';
      html += `<div class="word-display">`;
      html += `<p class="text-white text-4xl font-extrabold break-words max-w-full" style="user-select: text;">${currentContent.german}</p>`;
      html += `<button id="playGerman" class="speak-button button-blue">Prehrať v nemčine</button>`;
      html += `</div>`;

      if (showSlovak) {
        html += `<div class="slovak-display">
          <p class="text-white text-xl font-semibold break-words max-w-full" style="user-select: text;">${currentContent.slovak}</p>
          <button id="playSlovak" class="speak-button button-green">Prehrať v slovenčine</button>
        </div>`;
      }

      html += `<div class="flex flex-col space-y-3 mt-8">`;
      html += `<button id="revealBtn" class="button button-indigo">Zobraziť preklad</button>`;
      html += `<button id="nextBtn" class="button button-red">Ďalšie slovo</button>`;

      if (currentChapter === 'main') {
        html += `<button id="switch-to-kpak-btn" class="button button-green mt-4">Prejsť na kapitolu KPAK</button>`;
      } else {
        html += `<button id="back-to-main-btn" class="button button-green mt-4">Návrat k hlavnému zoznamu</button>`;
      }
      html += `</div>`;

      appContent.innerHTML = html;

      document.getElementById('playGerman').addEventListener('click', () => { speakText(currentContent.german, 'de'); });
      document.getElementById('nextBtn').addEventListener('click', () => { handleNext(); });
      document.getElementById('revealBtn').addEventListener('click', () => { handleReveal(); });

      if (showSlovak) {
        document.getElementById('playSlovak').addEventListener('click', () => { speakText(currentContent.slovak, 'sk'); });
      }

      if (currentChapter === 'main') {
        document.getElementById('switch-to-kpak-btn').addEventListener('click', switchToKpak);
      } else {
        document.getElementById('back-to-main-btn').addEventListener('click', switchToMain);
      }
    }

    // prvé vykreslenie
    getNextWord();

    // ===== AUTO režim (bez zmeny UI) =====
    const $ = (id)=>document.getElementById(id);
    const elStart = $("auto-start");
    const elPause = $("auto-pause");
    const elResume= $("auto-resume");
    const elStop  = $("auto-stop");
    const elPrev  = $("auto-prev");
    const elNext  = $("auto-next");
    const elStatus= $("auto-status");

    const st = {
      running:false, paused:false,
      get list(){ return currentChapter === 'main' ? vocabularyList : kpakContent; },
      get i(){ return currentChapter === 'main' ? currentWordIndex : kpakIndex; },
      set i(v){ if (currentChapter === 'main') currentWordIndex = v; else kpakIndex = v; saveProgress(); render(); }
    };

    function setBtns(){
      elStart.disabled  = st.running;
      elPause.disabled  = !st.running || st.paused;
      elResume.disabled = !st.running || !st.paused;
      elStop.disabled   = !st.running;
      elPrev.disabled   = !st.running;
      elNext.disabled   = !st.running;
    }
    function status(t){ elStatus.textContent = t; }

    async function playItem(i){
      const item = st.list[i];
      if (!item) return false;
      status(`🔊 DE: ${item.german}`);
      await TTS.speak(item.german, 'de-DE');
      if (!st.running) return false;
      showSlovak = true; saveProgress(); render();
      status(`🔊 SK: ${item.slovak}`);
      await TTS.speak(item.slovak, 'sk-SK');
      return true;
    }

    async function loop(){
      setBtns();
      while (st.running){
        if (st.paused) { await new Promise(r=>setTimeout(r,120)); continue; }
        const ok = await playItem(st.i);
        if (!ok || !st.running) break;
        st.i++;
        if (st.i >= st.list.length) {
          if (currentChapter === 'main' && kpakContent.length) {
            currentChapter = 'kpak';
            st.i = 0;
            showSlovak = false; saveProgress(); render();
            continue;
          } else {
            stopAuto();
            break;
          }
        }
        showSlovak = false; saveProgress(); render();
      }
    }

    function startAuto(){
      currentChapter = 'main';
      currentWordIndex = 0;
      kpakIndex = 0;
      st.running = true; st.paused = false;
      status("Auto režim beží…");
      setBtns();
      saveProgress();
      loop();
    }
    function stopAuto(){
      st.running = false; st.paused = false;
      TTS.cancel();
      status("Zastavené.");
      setBtns();
      saveProgress();
    }
    function pauseAuto(){
      st.paused = true;
      try { speechSynthesis.pause(); } catch{}
      status("Pauza.");
      setBtns();
      saveProgress();
    }
    function resumeAuto(){
      st.paused = false;
      try { speechSynthesis.resume(); } catch{}
      status("Pokračujem…");
      setBtns();
      saveProgress();
    }
    function prevOne(){
      if (!st.running) return;
      st.i = Math.max(0, st.i - 1);
      TTS.cancel();
      saveProgress();
    }
    function nextOne(){
      if (!st.running) return;
      st.i = Math.min(st.list.length - 1, st.i + 1);
      TTS.cancel();
      saveProgress();
    }

    elStart.addEventListener('click', startAuto);
    elStop .addEventListener('click', stopAuto);
    elPause.addEventListener('click', pauseAuto);
    elResume.addEventListener('click', resumeAuto);
    elPrev .addEventListener('click', prevOne);
    elNext .addEventListener('click', nextOne);

    // ===== FORMULÁR: pridanie slova + ukladanie do localStorage =====
    const formBox = document.createElement('div');
    formBox.className = "panel";
    formBox.innerHTML = `
      <h2 class="text-xl font-bold mb-4">Pridaj nové slovíčko</h2>
      <input id="newGerman" type="text" placeholder="Nemecké slovo" class="border p-2 rounded w-full mb-2">
      <input id="newSlovak" type="text" placeholder="Slovenský preklad" class="border p-2 rounded w-full mb-2">
      <button id="addWordBtn" class="button button-green w-full">Pridať slovo</button>
    `;
    document.querySelector(".container").appendChild(formBox);

    document.getElementById('addWordBtn').addEventListener('click', () => {
      const german = document.getElementById('newGerman').value.trim();
      const slovak = document.getElementById('newSlovak').value.trim();
      if (!german || !slovak) return;

      // uloženie do runtime zoznamu (zachová dizajn/logiku)
      vocabularyList.push({ german, slovak });

      // uloženie do localStorage (iba novinky, neničí existujúce)
      const fresh = loadUserVocab();
      fresh.push({ german, slovak });
      saveUserVocab(fresh);

      alert("Slovo bolo pridané (uložené lokálne).");
      document.getElementById('newGerman').value = "";
      document.getElementById('newSlovak').value = "";
      saveProgress();
    });

    // ===== Service worker (offline podpora) =====
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/nemecky-jazyk/sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
