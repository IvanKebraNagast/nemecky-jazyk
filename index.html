<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Precviƒçovanie nemƒçiny</title>

  <!-- PWA META -->
  <meta name="theme-color" content="#4f46e5" />
  <link rel="manifest" href="/nemecky-jazyk/manifest.webmanifest" />
  <link rel="apple-touch-icon" href="/nemecky-jazyk/icon.png">

  <!-- Tailwind + fonty -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f1f5f9;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
      box-sizing: border-box;
      user-select: auto;
    }
    .container {
      background-color: #f87171;
      border-radius: 1.5rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      padding: 2rem;
      max-width: 600px;
      width: 100%;
      text-align: center;
      border: 4px solid #818cf8;
    }
    .button {
      padding: 0.75rem 2rem;
      font-weight: bold;
      border-radius: 9999px;
      color: white;
      transition: all 0.2s ease-in-out;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .button-indigo { background-color: #4f46e5; }
    .button-indigo:hover { background-color: #4338ca; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button-green { background-color: #22c55e; }
    .button-green:hover { background-color: #16a34a; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button-blue { background-color: #3b82f6; }
    .button-blue:hover { background-color: #2563eb; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button-red { background-color: #ef4444; }
    .button-red:hover { background-color: #dc2626; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
    .button:disabled { background-color: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }
    .word-display { min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .slovak-display { min-height: 50px; margin-top: 1rem; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .speak-button {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 0.5rem 1rem; font-weight: bold; border-radius: 9999px;
      color: white; transition: all 0.2s ease-in-out; cursor: pointer; margin-top: 0.5rem;
    }
    .speak-button:disabled { background-color: #cbd5e1; cursor: not-allowed; color: #64748b; }
    .credits-box { background-color: #d1fae5; border: 2px solid #34d399; border-radius: 0.5rem; padding: 1rem; margin-top: 2rem; text-align: center; }
    .credits-text { color: #7c3aed; font-weight: bold; }

    /* auto panel */
    .panel { background:#fff;border:2px solid #818cf8;border-radius:1rem;padding:1rem;margin-bottom:1rem }
    .row { display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;align-items:center }
    .muted { opacity:.85 }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-3xl font-bold text-slate-800 mb-4">Precviƒçovanie nemƒçiny</h1>

    <!-- ‚úÖ NOV√â: panel automatick√©ho prehr√°vania (bez inputov) -->
    <div class="panel">
      <div class="row">
        <button id="auto-start"  class="button button-green">‚ñ∂Ô∏è Spusti≈• auto</button>
        <button id="auto-pause"  class="button button-indigo" disabled>‚è∏Ô∏è Pauza</button>
        <button id="auto-resume" class="button button-indigo" disabled>‚ñ∂Ô∏è Pokraƒçova≈•</button>
        <button id="auto-stop"   class="button button-red"    disabled>‚èπÔ∏è Stop</button>
        <button id="auto-prev"   class="button button-blue"   disabled>‚èÆÔ∏è Predo≈°l√©</button>
        <button id="auto-next"   class="button button-blue"   disabled>‚è≠Ô∏è ƒéal≈°ie</button>
      </div>
      <div id="auto-status" class="muted" style="margin-top:.5rem;text-align:left">Pripraven√©‚Ä¶</div>
    </div>

    <!-- p√¥vodn√Ω obsah aplik√°cie -->
    <div id="app-content"></div>

    <div class="credits-box">
      <span class="credits-text">Vytvoril: Ivan Kebra Nagast</span>
    </div>
  </div>

  <script>
    // --- P√îVODN√â TTS (len drobn√° √∫prava: vracia Promise, aby sa dalo ƒçaka≈•) ---
    const TTS = (() => {
      const synth = window.speechSynthesis;

      function loadVoicesOnce() {
        return new Promise(resolve => {
          if (!('speechSynthesis' in window)) { resolve([]); return; }
          let voices = synth.getVoices();
          if (voices && voices.length) { resolve(voices); return; }

          const onChange = () => {
            voices = synth.getVoices();
            if (voices && voices.length) {
              synth.removeEventListener('voiceschanged', onChange);
              resolve(voices);
            }
          };
          synth.addEventListener('voiceschanged', onChange);

          const iv = setInterval(() => {
            voices = synth.getVoices();
            if (voices && voices.length) {
              clearInterval(iv);
              synth.removeEventListener('voiceschanged', onChange);
              resolve(voices);
            }
          }, 200);

          setTimeout(() => {
            clearInterval(iv);
            synth.removeEventListener('voiceschanged', onChange);
            resolve(synth.getVoices() || []);
          }, 3000);
        });
      }

      function pickVoiceByLang(lang, preferNames = []) {
        const list = (synth.getVoices() || []).filter(v => (v.lang || "").toLowerCase().startsWith(lang.toLowerCase()));
        if (!list.length) return null;
        for (const name of preferNames) {
          const hit = list.find(v => (v.name || "").toLowerCase().includes(name.toLowerCase()));
          if (hit) return hit;
        }
        return list[0];
      }

      async function speak(text, langCode) {
        if (!('speechSynthesis' in window)) return;
        await loadVoicesOnce();

        const u = new SpeechSynthesisUtterance(text);
        u.lang = langCode; // "de-DE" alebo "sk-SK"

        const prefer = langCode === "de-DE"
          ? ["Anna","Markus","Katja","Yannick"]
          : ["Laura","Zuzana","Filip","J√°n"];

        const voice = pickVoiceByLang(langCode, prefer);
        if (voice) u.voice = voice;

        u.rate = 1.0; u.pitch = 1.0; u.volume = 1.0;

        return new Promise(res => {
          try {
            synth.cancel();
            u.onend = res;
            u.onerror = res;
            synth.speak(u);
          } catch(_) { res(); }
        });
      }

      return { speak, cancel(){ try{ window.speechSynthesis.cancel(); }catch(_){} } };
    })();
    // --- Koniec TTS ƒçasti ---

    document.addEventListener('DOMContentLoaded', () => {
      // ===== tvoje P√îVODN√â D√ÅTA (preskoƒç√≠m ‚Äì vlo≈æ si cel√Ω p√¥vodn√Ω zoznam; ni≈æ≈°ie zost√°va logika) =====
      const vocabularyList = [
        { german: 'Vermutung', slovak: 'domienka, tu≈°enie' },
        { german: 'Verm√∂gen', slovak: 'majetok, schopnos≈•' },
        { german: '√§u√üerste', slovak: 'najkrajnej≈°√≠, krajnos≈•' },
        { german: 'die Ank√ºndigung', slovak: 'ozn√°menie, ohl√°senie, oznam' },
        { german: 'Fahrgestell', slovak: 'podvozok' },
        { german: 'zu sch√§tzen', slovak: 'oceni≈•' },
        { german: 'loszulassen', slovak: 'necha≈• √≠s≈•' },
        { german: 'zusammenkommen', slovak: 'da≈• sa dokopy' },
        { german: 'auseinander', slovak: 'od seba' },
        { german: 'ein bisschen auseinander stehen', slovak: 'st√°≈• bl√≠zko od seba' },
        { german: 'sich auseinander entwickeln', slovak: 'odv√≠ja≈• sa jeden od druh√©ho' },
        { german: 'begegnen', slovak: 'stretn√∫≈•' },
        { german: 'begegnet', slovak: 'stretol' },
        { german: 'der/die Zweifel', slovak: 'neistota, pochybnos≈•' },
        /* ‚Ä¶ cel√Ω tvoj p√¥vodn√Ω zoznam ‚Ä¶ */
        { german: 'Ich musste mich entscheiden', slovak: 'musel som sa rozhodn√∫≈•' }
      ];

      const kpakContent = [
        { german: 'KPAK', slovak: 'KPAK' },
        { german: 'Wann?', slovak: 'Kedy?' },
        { german: 'Warum?', slovak: 'Preƒço?' },
        { german: 'Wie?', slovak: 'Ako?' },
        { german: 'Wo?', slovak: 'Kde?' },
        { german: 'Ich gehe', slovak: 'Idem / P√¥jdem' },
        { german: '‚û°Ô∏è morgen', slovak: '‚û°Ô∏è zajtra' },
        { german: '‚û°Ô∏è wegen meiner Arbeit', slovak: '‚û°Ô∏è kv√¥li mojej pr√°ci' },
        { german: '‚û°Ô∏è mit dem Fahrrad', slovak: '‚û°Ô∏è na bicykli' },
        { german: '‚û°Ô∏è in die Stadt', slovak: '‚û°Ô∏è do mesta' },
        { german: 'holen', slovak: 'prinies≈•, z√°js≈• po nieƒço / niekoho, donies≈• sp√§≈•' },
        { german: 'Ich hole mir ein Glas Wasser.', slovak: 'Idem si po poh√°r vody.' },
        { german: 'Kannst du die Zeitung holen?', slovak: 'M√¥≈æe≈° prinies≈• noviny.' },
        { german: 'abholen', slovak: 'vyzdvihn√∫≈• (niekoho / nieƒço) z miesta' },
        { german: 'Ich hole dich vom Bahnhof ab.', slovak: 'Pr√≠dem ≈•a vyzdvihn√∫≈• na stanicu.' },
        { german: 'Er holt das Paket ab.', slovak: 'Ide si po bal√≠k.' },
        { german: 'sich erholen', slovak: 'odpoƒçin√∫≈• si, zotavi≈• sa, zregenerova≈•' },
        { german: 'Ich erhole mich am Wochenende.', slovak: 'Odd√Ωchnem si cez v√≠kend.' },
        { german: 'Sie hat sich nach der Krankheit gut erholt.', slovak: 'Dobre sa zotavila po chorobe.' },
        { german: 'durchn√§sst', slovak: 'premoƒçen√Ω, cel√Ω mokr√Ω' },
        { german: 'z√§hlen auf + Akkusativ', slovak: 'spolieha≈• sa na niekoho / nieƒço' },
        { german: 'Ich z√§hle auf dich.', slovak: 'Spolieham sa na teba.' },
        { german: 'Du kannst auf mich z√§hlen.', slovak: 'M√¥≈æe≈° sa na m≈àa spoƒæahn√∫≈•.' },
        { german: 'z√§hlen zu + Dativ', slovak: 'patri≈• k niekomu / nieƒçomu' },
        { german: 'Er z√§hlt zu den Besten.', slovak: 'Patr√≠ medzi najlep≈°√≠ch.' },
        { german: 'Das z√§hlt zu meinen Lieblingsb√ºchern.', slovak: 'To patr√≠ medzi moje obƒæ√∫ben√© knihy.' },
      ];

      const appContent = document.getElementById('app-content');
      let currentWordIndex = 0;
      let showSlovak = false;
      let currentChapter = 'main';
      let kpakIndex = 0;

      const speakText = async (text, langShort) => {
        const lang = (langShort === 'de') ? 'de-DE' : 'sk-SK';
        await TTS.speak(text, lang);
      };

      const getNextWord = () => {
        showSlovak = false;
        if (currentChapter === 'main') {
          if (currentWordIndex >= vocabularyList.length) currentWordIndex = 0;
        } else {
          if (kpakIndex >= kpakContent.length) kpakIndex = 0;
        }
        render();
      };

      const handleReveal = () => { showSlovak = true; render(); };

      const handleNext = () => {
        if (currentChapter === 'main') currentWordIndex++;
        else kpakIndex++;
        getNextWord();
      };

      const switchToKpak = () => { currentChapter = 'kpak'; kpakIndex = 0; getNextWord(); };
      const switchToMain = () => { currentChapter = 'main'; currentWordIndex = 0; getNextWord(); };

      const render = () => {
        let currentContent;
        if (currentChapter === 'main') {
          if (currentWordIndex >= vocabularyList.length) {
            appContent.innerHTML = `
              <div class="word-display">
                <p class="text-3xl font-extrabold text-white">Gratulujem!</p>
                <p class="text-xl font-semibold text-white mt-4">Pre≈°li ste v≈°etky slov√°.</p>
                <button id="restartBtn" class="button button-indigo mt-8">Zaƒça≈• odznova</button>
                <button id="switch-to-kpak-btn" class="button button-green mt-4">Prejs≈• na kapitolu KPAK</button>
              </div>`;
            document.getElementById('restartBtn').addEventListener('click', () => { currentWordIndex = 0; getNextWord(); });
            document.getElementById('switch-to-kpak-btn').addEventListener('click', switchToKpak);
            return;
          }
          currentContent = vocabularyList[currentWordIndex];
        } else {
          if (kpakIndex >= kpakContent.length) {
            appContent.innerHTML = `
              <div class="word-display">
                <p class="text-3xl font-extrabold text-white">Koniec kapitoly KPAK!</p>
                <p class="text-xl font-semibold text-white mt-4">Pre≈°li ste v≈°etky slov√° z tejto sekcie.</p>
                <button id="back-to-main-btn" class="button button-indigo mt-8">N√°vrat k hlavn√©mu zoznamu</button>
                <button id="restartKpakBtn" class="button button-green mt-4">Zaƒça≈• odznova kapitolu KPAK</button>
              </div>`;
            document.getElementById('back-to-main-btn').addEventListener('click', switchToMain);
            document.getElementById('restartKpakBtn').addEventListener('click', () => { kpakIndex = 0; getNextWord(); });
            return;
          }
          currentContent = kpakContent[kpakIndex];
        }

        let html = '';
        html += `<div class="word-display">`;
        html += `<p class="text-white text-4xl font-extrabold break-words max-w-full" style="user-select: text;">${currentContent.german}</p>`;
        html += `<button id="playGerman" class="speak-button button-blue">Prehra≈• v nemƒçine</button>`;
        html += `</div>`;

        if (showSlovak) {
          html += `<div class="slovak-display">
              <p class="text-white text-xl font-semibold break-words max-w-full" style="user-select: text;">${currentContent.slovak}</p>
              <button id="playSlovak" class="speak-button button-green">Prehra≈• v slovenƒçine</button>
            </div>`;
        }

        html += `<div class="flex flex-col space-y-3 mt-8">`;
        html += `<button id="revealBtn" class="button button-indigo">Zobrazi≈• preklad</button>`;
        html += `<button id="nextBtn" class="button button-red">ƒéal≈°ie slovo</button>`;

        if (currentChapter === 'main') {
          html += `<button id="switch-to-kpak-btn" class="button button-green mt-4">Prejs≈• na kapitolu KPAK</button>`;
        } else {
          html += `<button id="back-to-main-btn" class="button button-green mt-4">N√°vrat k hlavn√©mu zoznamu</button>`;
        }

        html += `</div>`;

        appContent.innerHTML = html;

        document.getElementById('playGerman').addEventListener('click', () => { speakText(currentContent.german, 'de'); });
        document.getElementById('nextBtn').addEventListener('click', handleNext);
        document.getElementById('revealBtn').addEventListener('click', handleReveal);

        if (showSlovak) {
          document.getElementById('playSlovak').addEventListener('click', () => { speakText(currentContent.slovak, 'sk'); });
        }

        if (currentChapter === 'main') {
          document.getElementById('switch-to-kpak-btn').addEventListener('click', () => { currentChapter = 'kpak'; kpakIndex = 0; getNextWord(); });
        } else {
          document.getElementById('back-to-main-btn').addEventListener('click', () => { currentChapter = 'main'; currentWordIndex = 0; getNextWord(); });
        }
      };

      getNextWord();

      // ====== NOV√â: LOGIKA AUTO-RE≈ΩIMU (okam≈æite hr√°, ≈æiadne oneskorenie navy≈°e) ======
      const $ = (id) => document.getElementById(id);
      const elStart = $("auto-start");
      const elPause = $("auto-pause");
      const elResume= $("auto-resume");
      const elStop  = $("auto-stop");
      const elPrev  = $("auto-prev");
      const elNext  = $("auto-next");
      const elStatus= $("auto-status");

      const st = {
        running:false, paused:false,
        get list(){ return currentChapter === 'main' ? vocabularyList : kpakContent; },
        get i(){ return currentChapter === 'main' ? currentWordIndex : kpakIndex; },
        set i(v){ if (currentChapter === 'main') currentWordIndex = v; else kpakIndex = v; }
      };

      function setBtns(){
        elStart.disabled  = st.running;
        elPause.disabled  = !st.running || st.paused;
        elResume.disabled = !st.running || !st.paused;
        elStop.disabled   = !st.running;
        elPrev.disabled   = !st.running;
        elNext.disabled   = !st.running;
      }
      function status(t){ elStatus.textContent = t; }

      async function playItem(i){
        const item = st.list[i];
        if (!item) return false;

        // DE hneƒè
        status(`üîä DE: ${item.german}`);
        await TTS.speak(item.german, 'de-DE');
        if (!st.running) return false;

        // uk√°≈æ preklad a hneƒè SK
        showSlovak = true; render();
        status(`üîä SK: ${item.slovak}`);
        await TTS.speak(item.slovak, 'sk-SK');
        return true;
      }

      async function loop(){
        setBtns();
        while (st.running){
          if (st.paused) { await new Promise(r=>setTimeout(r,120)); continue; }
          const ok = await playItem(st.i);
          if (!ok || !st.running) break;
          st.i++;
          if (st.i >= st.list.length) { stopAuto(); break; }
          showSlovak = false; render();
        }
      }

      function startAuto(){
        if (!st.list.length) return;
        st.running = true; st.paused = false;
        status("Auto re≈æim be≈æ√≠‚Ä¶");
        setBtns();
        loop();
      }
      function stopAuto(){
        st.running = false; st.paused = false;
        TTS.cancel();
        status("Zastaven√©.");
        setBtns();
      }
      function pauseAuto(){
        st.paused = true;
        try { speechSynthesis.pause(); } catch(_){}
        status("Pauza.");
        setBtns();
      }
      function resumeAuto(){
        st.paused = false;
        try { speechSynthesis.resume(); } catch(_){}
        status("Pokraƒçujem‚Ä¶");
        setBtns();
      }
      function prevOne(){
        if (!st.running) return;
        st.i = Math.max(0, st.i - 1);
        TTS.cancel();
      }
      function nextOne(){
        if (!st.running) return;
        st.i = Math.min(st.list.length - 1, st.i + 1);
        TTS.cancel();
      }

      elStart.addEventListener('click', startAuto);
      elStop .addEventListener('click', stopAuto);
      elPause.addEventListener('click', pauseAuto);
      elResume.addEventListener('click', resumeAuto);
      elPrev .addEventListener('click', prevOne);
      elNext .addEventListener('click', nextOne);
      // ====== KONIEC AUTO-RE≈ΩIMU ======
    });

    // PWA: registr√°cia SW ‚Äì NECH√ÅVAME PRESNE AKO SI MAL
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/nemecky-jazyk/sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
